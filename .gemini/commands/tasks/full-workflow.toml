[metadata]
argument-hint = "{{args}}"
description = "Execute the full workflow from plan creation to blueprint execution"

[prompt]
content = """# Full Workflow Execution\n\n## Assistant Configuration\n\nBefore proceeding with this command, you MUST load and respect the assistant's configuration:\n\n**Run the following scripts:**\n```bash\nASSISTANT=$(node .ai/task-manager/config/scripts/detect-assistant.cjs)\nnode .ai/task-manager/config/scripts/read-assistant-config.cjs \"$ASSISTANT\"\n```\n\nThe output above contains your global and project-level configuration rules. You MUST keep these rules and guidelines in mind during all subsequent operations in this command.\n\n---\n\nYou are a workflow orchestration assistant. Your role is to execute the complete task management workflow from plan creation through blueprint execution with minimal user interaction.\n\n## Instructions\n\nThe user input is:\n\n<user-input>\n{{args}}\n</user-input>\n\nIf no user input is provided, stop immediately and show an error message to the user.\n\n### Workflow Execution Process\n\nUse your internal Todo task tool to track the workflow execution:\n\n- [ ] Execute /tasks:create-plan\n- [ ] Extract plan ID\n- [ ] Execute /tasks:generate-tasks\n- [ ] Execute /tasks:execute-blueprint\n- [ ] Generate execution summary\n\n#### Step 1: Determine Next Plan ID\n\nBefore creating the plan, determine what the next plan ID will be:\n\n```bash\nnode .ai/task-manager/config/scripts/get-next-plan-id.cjs\n```\n\nStore this ID for later validation and use.\n\n#### Step 2: Execute Plan Creation\n\nUse the SlashCommand tool to execute plan creation with the user's prompt:\n\n```\n/tasks:create-plan {{args}}\n```\n\n**Important**: The plan creation command may ask clarification questions. Wait for user responses before continuing. This is expected behavior and maintains quality control.\n\nAfter plan creation completes, provide minimal progress update:\n\"Step 1/4: Plan created (ID: [plan-id])\"\n\n**CRITICAL**: Do not wait for user approval or review of the plan. In full-workflow mode, plan validation is automated (Step 3 performs file existence checking only). Proceed immediately to Step 3 without waiting for user input.\n\n#### Step 3: Validate Plan Creation and Set Approval Method\n\nVerify the plan was created successfully and set it to automated workflow mode:\n\n```bash\n# Find the created plan file\nPLAN_FILE=$(find .ai/task-manager/plans -name \"plan-[0-9][0-9]*--*.md\" -type f -exec grep -l \"^id: \\?[plan-id]$\" {} \\;)\n\n# Verify plan exists\nif [ -z \"$PLAN_FILE\" ]; then\n  echo \"‚ùå Error: Plan creation failed. Expected plan with ID [plan-id] not found.\"\n  exit 1\nfi\n\n# Set approval_method to auto for automated workflow execution\n# This ensures generate-tasks and execute-blueprint run without interruption\nif ! grep -q \"^approval_method:\" \"$PLAN_FILE\"; then\n  # Insert approval_method after the created: line in frontmatter\n  sed -i.bak '/^created:/a\\\napproval_method: auto' \"$PLAN_FILE\" && rm -f \"${PLAN_FILE}.bak\"\nelse\n  # Update existing approval_method to auto\n  sed -i.bak 's/^approval_method:.*/approval_method: auto/' \"$PLAN_FILE\" && rm -f \"${PLAN_FILE}.bak\"\nfi\n```\n\n**Note**: Setting `approval_method: auto` in the plan metadata signals to subordinate commands (generate-tasks, execute-blueprint) that they are running in automated workflow mode and should suppress interactive prompts for plan review. This metadata persists in the plan document and is reliably read by subsequent commands, eliminating dependency on environment variables.\n\n#### Step 4: Execute Task Generation\n\nUse the SlashCommand tool to generate tasks for the plan:\n\n```\n/tasks:generate-tasks [plan-id]\n```\n\nAfter task generation completes, provide minimal progress update:\n\"Step 2/4: Tasks generated for plan [plan-id]\"\n\n#### Step 5: Execute Blueprint\n\nUse the SlashCommand tool to execute the blueprint:\n\n```\n/tasks:execute-blueprint [plan-id]\n```\n\nAfter blueprint execution completes, provide minimal progress update:\n\"Step 3/4: Blueprint execution completed\"\n\nNote: The execute-blueprint command automatically archives the plan upon successful completion.\n\n#### Step 6: Generate Execution Summary\n\nAfter all steps complete successfully, generate a comprehensive summary:\n\n```\n‚úÖ Full workflow completed successfully!\n\nPlan: [plan-id]--[plan-name]\nLocation: .ai/task-manager/archive/[plan-id]--[plan-name]/\n\nStatus: Archived and ready for review\n\nüìã Next Steps:\n- Review the implementation in the archived plan\n- Check the execution summary in the plan document\n- Verify all validation gates passed\n\nPlan document: .ai/task-manager/archive/[plan-id]--[plan-name]/plan-[plan-id]--[plan-name].md\n```\n\n### Error Handling\n\nIf any step fails:\n1. Halt execution immediately\n2. Report clear error message indicating which step failed\n3. Preserve all created artifacts (plan, tasks) for manual review\n4. Provide guidance for manual continuation:\n   - If plan creation failed: Review error and retry\n   - If task generation failed: Run `/tasks:generate-tasks [plan-id]` manually after reviewing plan\n   - If blueprint execution failed: Review tasks and run `/tasks:execute-blueprint [plan-id]` manually\n\n### Output Requirements\n\n**During Execution:**\n- Minimal progress updates at each major step\n- Clear indication of current step (1/4, 2/4, etc.)\n\n**After Completion:**\n- Comprehensive summary with plan location\n- Status confirmation (Archived)\n- Next steps for user review\n- Direct link to plan document\n\n**On Error:**\n- Clear error message\n- Indication of which step failed\n- Manual recovery instructions\n"""
