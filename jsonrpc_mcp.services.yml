services:
  jsonrpc_mcp.tool_discovery:
    class: Drupal\jsonrpc_mcp\Service\McpToolDiscoveryService
    arguments: ['@jsonrpc.handler', '@current_user']

  jsonrpc_mcp.tool_normalizer:
    class: Drupal\jsonrpc_mcp\Normalizer\McpToolNormalizer

  jsonrpc_mcp.middleware.oauth_scope_validator:
    class: Drupal\jsonrpc_mcp\Middleware\OAuthScopeValidator
    arguments:
      $toolDiscovery: '@jsonrpc_mcp.tool_discovery'
      $entityTypeManager: '@entity_type.manager'
    tags:
      - { name: http_middleware, priority: 200 }
